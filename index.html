<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Silver Canyon Cupping</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 50px;
        }
        form {
            max-width: 400px;
            margin: auto;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 10px;
            box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
        }
        input {
            display: block;
            width: 90%;
            margin: 10px auto;
            padding: 10px;
        }
        button {
            background-color: #28a745;
            color: white;
            padding: 10px;
            border: none;
            cursor: pointer;
            margin-top: 10px;
        }
        button:hover {
            background-color: #218838;
        }
        #plotContainer {
            display: none;
            margin-top: 20px;
        }
        table {
            margin: auto;
            border-collapse: collapse;
            width: 60%;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #4CAF50;
            color: white;
        }
    </style>
</head>
<body>
    <h2>Enter your score for each cup</h2>
    <form id="scoreForm">
        <input type="text" id="name" placeholder="Your Name" required>
        <input type="number" id="sample" placeholder="Sample #" required>
        <input type="number" id="fragrance" placeholder="Fragrance 1-10" required>
        <input type="number" id="flavor" placeholder="Flavor 1-10" required>
        <input type="number" id="body" placeholder="Body 1-10" required>
        <input type="number" id="aftertaste" placeholder="Aftertaste 1-10" required>
        <input type="number" id="balance" placeholder="Balance -10-+5" required>
        <button type="submit">Submit</button>
    </form>
    <p id="response"></p>

    <button id="plotButton">Plot</button>
    <p id="plotResponse"></p>

    <div id="plotContainer">
        <h3>Average Scores Per Sample</h3>
        <table id="plotTable">
            <thead>
                <tr>
                    <th>Sample</th>
                    <th>Average Score</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <script>
        document.getElementById("scoreForm").addEventListener("submit", function(event) {
            event.preventDefault();
            
            let name = document.getElementById("name").value;
            let sample = document.getElementById("sample").value;
            let fragrance = document.getElementById("fragrance").value;
            let flavor = document.getElementById("flavor").value;
            let body = document.getElementById("body").value;
            let aftertaste = document.getElementById("aftertaste").value;
            let balance = document.getElementById("balance").value;

            let data = {
                name: name,
                sample: sample,
                fragrance: fragrance,
                flavor: flavor,
                body: body,
                aftertaste: aftertaste,
                balance: balance
            };

            fetch("https://script.google.com/macros/s/AKfycbygd_RCGRcMGvjy6jP4sHl_2P1ABCr2GyfBAuK_jIiVo7U4kuQxtsqMQJSjL7yjlO2kqw/exec", {
                method: "POST",
                mode: "no-cors",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            }).then(() => {
                document.getElementById("response").innerText = "Submitted successfully!";
                document.getElementById("scoreForm").reset();
            }).catch(error => {
                document.getElementById("response").innerText = "Error submitting.";
            });
        });

        document.getElementById("plotButton").addEventListener("click", function() {
            let password = prompt("Enter password:");
            if (password !== "goresults") {
                document.getElementById("plotResponse").innerText = "You're not Sam ya silly goose";
                return;
            }

            document.getElementById("plotResponse").innerText = "";

            fetch("https://script.google.com/macros/s/AKfycbygd_RCGRcMGvjy6jP4sHl_2P1ABCr2GyfBAuK_jIiVo7U4kuQxtsqMQJSjL7yjlO2kqw/exec?getAverages=true")
            .then(response => response.json())
            .then(data => {
                let tableBody = document.getElementById("plotTable").getElementsByTagName("tbody")[0];
                tableBody.innerHTML = "";  // Clear previous results

                data.forEach(entry => {
                    let row = tableBody.insertRow();
                    row.insertCell(0).innerText = entry.sample;
                    row.insertCell(1).innerText = entry.average;
                });

                document.getElementById("plotContainer").style.display = "block";
            })
            .catch(error => {
                document.getElementById("plotResponse").innerText = "Error fetching data.";
            });
        });
    </script>
</body>
</html>
